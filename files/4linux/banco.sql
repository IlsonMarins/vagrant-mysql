DROP DATABASE IF EXISTS 4linux;

CREATE DATABASE 4linux;

USE 4linux;

CREATE TABLE cursos (
  id SMALLINT UNSIGNED PRIMARY KEY,
  nome VARCHAR(100) NOT NULL DEFAULT '',
  duracao TINYINT NOT NULL DEFAULT 0,
  valor FLOAT NOT NULL DEFAULT 0,
  cadastrado DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  alterado DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

INSERT INTO cursos (id, nome, duracao, valor) VALUES (450, 'Linux Beginners', 40, 1000.00),(451, 'Linux Administrator', 40, 1200.00),(452, 'Linux Engineer', 40, 1500.00),(801, 'MySQL', 40, 1400.00),(802, 'PostgreSQL', 40, 1400.00),(803, 'MongoDB', 40, 1400.00),(500, 'PHP Básico', 40, 1200.00),(501, 'PHP Intermediário', 40, 1200.00),(502, 'PHP Avançado', 40, 1200.00),(520, 'Python Básico', 40, 1200.00),(521, 'Python para Administradores', 40, 1400.00),(522, 'Python para Cientistas de Dados', 40, 1500.00),(525, 'Infraestrutura Ágil', 40, 1600.00),(540, 'Docker', 40, 1500.00),(541, 'Kubernetes', 40, 1500.00),(542, 'Openshift', 20, 1000.00),(543, 'Rancher', 20, 1000.00),(600, 'pfSense', 20, 800.00),(700, 'OpenLDAP e Samba', 20, 800.00),(900, 'Segurança em Servidores Linux', 40, 1500.00);

CREATE TABLE professores (
  cpf CHAR(14) PRIMARY KEY,
  nome VARCHAR(100) NOT NULL DEFAULT '',
  email VARCHAR(100) NOT NULL DEFAULT '',
  nascimento DATE NOT NULL DEFAULT '1970-01-01',
  cadastrado DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  alterado DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE alunos (
  cpf CHAR(14) PRIMARY KEY,
  nome VARCHAR(100) NOT NULL DEFAULT '',
  email VARCHAR(100) NOT NULL DEFAULT '',
  telefone CHAR(17) NOT NULL DEFAULT '',
  nascimento DATE NOT NULL DEFAULT '1970-01-01',
  cadastrado DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  alterado DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE alunos_extras (
  cpf CHAR(14) PRIMARY KEY,
  endereco VARCHAR(255) NOT NULL DEFAULT '',
  cidade_id SMALLINT UNSIGNED NOT NULL,
  cep CHAR(9) NOT NULL DEFAULT '',
  site VARCHAR(255) NOT NULL DEFAULT '',
  cv TEXT
);

CREATE TABLE turmas (
  id MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  professor_cpf CHAR(14) NOT NULL DEFAULT '',
  inicio DATETIME NOT NULL DEFAULT '1970-01-01 00:00:00',
  fim DATETIME NOT NULL DEFAULT '1970-01-01 00:00:00'
);

CREATE TABLE turmas_alunos (
  turma_id SMALLINT UNSIGNED NOT NULL,
  aluno_cpf CHAR(14) NOT NULL,
  PRIMARY KEY(turma_id, aluno_cpf)
);

CREATE TABLE alunos_compras (
  curso_id MEDIUMINT UNSIGNED NOT NULL,
  aluno_cpf CHAR(14) NOT NULL,
  turma_id MEDIUMINT UNSIGNED NOT NULL,
  valor FLOAT NOT NULL DEFAULT 0,
  PRIMARY KEY(aluno_cpf, turma_id, curso_id)
);

CREATE TABLE estados (
  uf CHAR(2) NOT NULL PRIMARY KEY,
  nome VARCHAR(20) NOT NULL
);

CREATE TABLE cidades (
  id SMALLINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  estado_uf CHAR(2) NOT NULL,
  nome VARCHAR(255) NOT NULL DEFAULT ''
);
